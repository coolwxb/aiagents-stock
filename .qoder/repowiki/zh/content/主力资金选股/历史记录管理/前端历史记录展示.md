# å‰ç«¯å†å²è®°å½•å±•ç¤º

<cite>
**æœ¬æ–‡æ¡£å¼•ç”¨çš„æ–‡ä»¶**  
- [index.vue](file://frontend/src/views/mainforce/index.vue)
- [mainforce.js](file://frontend/src/api/mainforce.js)
- [history.vue](file://frontend/src/views/mainforce/history.vue)
- [mainforce.py](file://backend/app/api/v1/mainforce.py)
- [mainforce_service.py](file://backend/app/services/mainforce_service.py)
- [mainforce_batch_db.py](file://backend/app/db/mainforce_batch_db.py)
</cite>

## ç›®å½•
1. [ç®€ä»‹](#ç®€ä»‹)
2. [é¡¹ç›®ç»“æ„](#é¡¹ç›®ç»“æ„)
3. [æ ¸å¿ƒç»„ä»¶](#æ ¸å¿ƒç»„ä»¶)
4. [æ¶æ„æ¦‚è§ˆ](#æ¶æ„æ¦‚è§ˆ)
5. [è¯¦ç»†ç»„ä»¶åˆ†æ](#è¯¦ç»†ç»„ä»¶åˆ†æ)
6. [ä¾èµ–åˆ†æ](#ä¾èµ–åˆ†æ)
7. [æ€§èƒ½è€ƒè™‘](#æ€§èƒ½è€ƒè™‘)
8. [æ•…éšœæ’é™¤æŒ‡å—](#æ•…éšœæ’é™¤æŒ‡å—)
9. [ç»“è®º](#ç»“è®º)

## ç®€ä»‹
æœ¬æ–‡æ¡£å…¨é¢é˜è¿°ä¸»åŠ›é€‰è‚¡å†å²è®°å½•åœ¨å‰ç«¯çš„å±•ç¤ºé€»è¾‘ä¸äº¤äº’è®¾è®¡ã€‚è¯¦ç»†è¯´æ˜`index.vue`ç»„ä»¶å¦‚ä½•é€šè¿‡è°ƒç”¨`mainforce.js`ä¸­çš„APIæ–¹æ³•è·å–å†å²æ•°æ®ï¼Œå¹¶ä½¿ç”¨æ—¶é—´è½´å¸ƒå±€å‘ˆç°åˆ†ææ‰¹æ¬¡ã€‚è§£é‡Šæœç´¢è¿‡æ»¤åŠŸèƒ½çš„å®ç°ï¼ŒåŒ…æ‹¬æ—¥æœŸé€‰æ‹©å™¨ã€çŠ¶æ€ç­›é€‰ä¸‹æ‹‰æ¡†å’Œå…³é”®è¯æœç´¢çš„åŒå‘ç»‘å®šæœºåˆ¶ã€‚æè¿°åˆ†é¡µç»„ä»¶çš„é›†æˆæ–¹å¼å’Œæ€§èƒ½ä¼˜åŒ–ï¼ˆå¦‚è™šæ‹Ÿæ»šåŠ¨ï¼‰ã€‚æä¾›UIçŠ¶æ€ç®¡ç†æ–¹æ¡ˆï¼ŒåŒ…æ‹¬åŠ è½½ä¸­ã€æ— æ•°æ®ã€é”™è¯¯æç¤ºç­‰åœºæ™¯çš„å¤„ç†ã€‚åŒ…å«ç•Œé¢æˆªå›¾å»ºè®®å’Œå“åº”å¼è®¾è®¡é€‚é…æ–¹æ¡ˆï¼Œç¡®ä¿åœ¨ä¸åŒè®¾å¤‡ä¸Šçš„å¯ç”¨æ€§ã€‚

## é¡¹ç›®ç»“æ„
ä¸»åŠ›é€‰è‚¡å†å²è®°å½•åŠŸèƒ½ä¸»è¦ç”±å‰ç«¯å’Œåç«¯ä¸¤éƒ¨åˆ†ç»„æˆã€‚å‰ç«¯ä½äº`frontend/src/views/mainforce/`ç›®å½•ä¸‹ï¼ŒåŒ…å«`index.vue`å’Œ`history.vue`ä¸¤ä¸ªä¸»è¦ç»„ä»¶æ–‡ä»¶ã€‚åç«¯APIä½äº`backend/app/api/v1/mainforce.py`ï¼ŒæœåŠ¡é€»è¾‘åœ¨`backend/app/services/mainforce_service.py`ä¸­å®ç°ï¼Œæ•°æ®å­˜å‚¨ä½¿ç”¨`backend/app/db/mainforce_batch_db.py`ä¸­çš„SQLiteæ•°æ®åº“ã€‚

```mermaid
graph TB
subgraph "å‰ç«¯"
indexVue[index.vue]
historyVue[history.vue]
mainforceJs[mainforce.js]
end
subgraph "åç«¯"
mainforcePy[mainforce.py]
mainforceServicePy[mainforce_service.py]
mainforceBatchDbPy[mainforce_batch_db.py]
database[(SQLite)]
end
indexVue --> mainforceJs
mainforceJs --> mainforcePy
mainforcePy --> mainforceServicePy
mainforceServicePy --> mainforceBatchDbPy
mainforceBatchDbPy --> database
```

**å›¾ç¤ºæ¥æº**  
- [index.vue](file://frontend/src/views/mainforce/index.vue)
- [mainforce.js](file://frontend/src/api/mainforce.js)
- [mainforce.py](file://backend/app/api/v1/mainforce.py)
- [mainforce_service.py](file://backend/app/services/mainforce_service.py)
- [mainforce_batch_db.py](file://backend/app/db/mainforce_batch_db.py)

**æœ¬èŠ‚æ¥æº**  
- [index.vue](file://frontend/src/views/mainforce/index.vue)
- [mainforce.js](file://frontend/src/api/mainforce.js)
- [mainforce.py](file://backend/app/api/v1/mainforce.py)
- [mainforce_service.py](file://backend/app/services/mainforce_service.py)
- [mainforce_batch_db.py](file://backend/app/db/mainforce_batch_db.py)

## æ ¸å¿ƒç»„ä»¶
ä¸»åŠ›é€‰è‚¡å†å²è®°å½•çš„æ ¸å¿ƒç»„ä»¶æ˜¯`index.vue`ä¸­çš„"ğŸ“š æ‰¹é‡å†å²"æ ‡ç­¾é¡µï¼Œå®ƒé›†æˆäº†æ—¶é—´è½´å±•ç¤ºã€æœç´¢è¿‡æ»¤ã€åˆ·æ–°åŠŸèƒ½å’Œè¯¦æƒ…æŸ¥çœ‹ç­‰äº¤äº’å…ƒç´ ã€‚è¯¥ç»„ä»¶é€šè¿‡è°ƒç”¨`mainforce.js`ä¸­çš„`getMainforceHistory` APIæ–¹æ³•è·å–å†å²æ•°æ®ï¼Œå¹¶ä½¿ç”¨Element UIçš„`el-timeline`ç»„ä»¶è¿›è¡Œå¯è§†åŒ–å±•ç¤ºã€‚

**æœ¬èŠ‚æ¥æº**  
- [index.vue](file://frontend/src/views/mainforce/index.vue#L242-L281)
- [mainforce.js](file://frontend/src/api/mainforce.js#L22-L28)

## æ¶æ„æ¦‚è§ˆ
ç³»ç»Ÿé‡‡ç”¨å‰åç«¯åˆ†ç¦»æ¶æ„ï¼Œå‰ç«¯é€šè¿‡RESTful APIä¸åç«¯é€šä¿¡ã€‚å†å²è®°å½•æ•°æ®å­˜å‚¨åœ¨SQLiteæ•°æ®åº“ä¸­ï¼Œåç«¯æä¾›åˆ†é¡µæŸ¥è¯¢æ¥å£ï¼Œå‰ç«¯è´Ÿè´£æ•°æ®å±•ç¤ºå’Œç”¨æˆ·äº¤äº’ã€‚

```mermaid
sequenceDiagram
participant ç”¨æˆ· as "ç”¨æˆ·"
participant å‰ç«¯ as "å‰ç«¯(index.vue)"
participant API as "API(mainforce.py)"
participant æœåŠ¡ as "æœåŠ¡(mainforce_service.py)"
participant æ•°æ®åº“ as "æ•°æ®åº“(mainforce_batch_db.py)"
ç”¨æˆ·->>å‰ç«¯ : åˆ‡æ¢åˆ°æ‰¹é‡å†å²æ ‡ç­¾é¡µ
å‰ç«¯->>å‰ç«¯ : created()ç”Ÿå‘½å‘¨æœŸé’©å­è§¦å‘
å‰ç«¯->>API : è°ƒç”¨getMainforceHistory()
API->>æœåŠ¡ : è°ƒç”¨get_history()æ–¹æ³•
æœåŠ¡->>æ•°æ®åº“ : è°ƒç”¨get_all_history()æ–¹æ³•
æ•°æ®åº“-->>æœåŠ¡ : è¿”å›å†å²è®°å½•åˆ—è¡¨
æœåŠ¡-->>API : è¿”å›åˆ†é¡µç»“æœ
API-->>å‰ç«¯ : è¿”å›JSONæ•°æ®
å‰ç«¯->>å‰ç«¯ : æ›´æ–°historyListæ•°æ®
å‰ç«¯->>ç”¨æˆ· : æ¸²æŸ“æ—¶é—´è½´å±•ç¤º
```

**å›¾ç¤ºæ¥æº**  
- [index.vue](file://frontend/src/views/mainforce/index.vue#L524-L526)
- [mainforce.js](file://frontend/src/api/mainforce.js#L22-L28)
- [mainforce.py](file://backend/app/api/v1/mainforce.py#L48-L61)
- [mainforce_service.py](file://backend/app/services/mainforce_service.py#L208-L234)
- [mainforce_batch_db.py](file://backend/app/db/mainforce_batch_db.py#L149-L193)

## è¯¦ç»†ç»„ä»¶åˆ†æ

### ä¸»åŠ›é€‰è‚¡å†å²è®°å½•åˆ†æ
`index.vue`ç»„ä»¶ä¸­çš„"ğŸ“š æ‰¹é‡å†å²"æ ‡ç­¾é¡µå®ç°äº†å†å²è®°å½•çš„å®Œæ•´å±•ç¤ºé€»è¾‘ã€‚å½“ç”¨æˆ·è¿›å…¥è¯¥é¡µé¢æ—¶ï¼Œ`created()`ç”Ÿå‘½å‘¨æœŸé’©å­ä¼šè‡ªåŠ¨è°ƒç”¨`loadHistory()`æ–¹æ³•åŠ è½½å†å²æ•°æ®ã€‚

#### æœç´¢è¿‡æ»¤åŠŸèƒ½å®ç°
æœç´¢è¿‡æ»¤åŠŸèƒ½é€šè¿‡`v-model`åŒå‘ç»‘å®šå®ç°ï¼Œ`historySearch`æ•°æ®å±æ€§ä¸æœç´¢è¾“å…¥æ¡†å…³è”ã€‚è¿‡æ»¤é€»è¾‘åœ¨`filteredHistory`è®¡ç®—å±æ€§ä¸­å®ç°ï¼Œæ”¯æŒå¯¹IDã€æ‘˜è¦å’Œæ—¶é—´èŒƒå›´çš„å…³é”®è¯æœç´¢ã€‚

```mermaid
flowchart TD
Start([å¼€å§‹]) --> SearchInput["ç”¨æˆ·è¾“å…¥æœç´¢å…³é”®è¯"]
SearchInput --> WatchTrigger{"historySearchå˜åŒ–è§¦å‘"}
WatchTrigger --> FilterLogic["æ‰§è¡ŒfilteredHistoryè®¡ç®—å±æ€§"]
FilterLogic --> KeywordExtract["æå–æœç´¢å…³é”®è¯"]
FilterLogic --> DataFilter["éå†historyListè¿›è¡Œè¿‡æ»¤"]
DataFilter --> ConditionCheck{"æ£€æŸ¥ID/æ‘˜è¦/èŒƒå›´æ˜¯å¦åŒ…å«å…³é”®è¯"}
ConditionCheck --> |æ˜¯| IncludeItem["åŒ…å«è¯¥è®°å½•"]
ConditionCheck --> |å¦| ExcludeItem["æ’é™¤è¯¥è®°å½•"]
IncludeItem --> BuildResult["æ„å»ºfilteredHistoryç»“æœ"]
ExcludeItem --> BuildResult
BuildResult --> UpdateView["æ›´æ–°æ—¶é—´è½´è§†å›¾"]
UpdateView --> End([ç»“æŸ])
```

**å›¾ç¤ºæ¥æº**  
- [index.vue](file://frontend/src/views/mainforce/index.vue#L514-L523)

#### æ—¶é—´è½´å¸ƒå±€å‘ˆç°
å†å²è®°å½•ä½¿ç”¨Element UIçš„`el-timeline`ç»„ä»¶è¿›è¡Œå±•ç¤ºï¼Œæ¯ä¸ª`el-timeline-item`ä»£è¡¨ä¸€ä¸ªåˆ†ææ‰¹æ¬¡ã€‚æ—¶é—´è½´é¡¹åŒ…å«æ‰¹æ¬¡IDã€æ‘˜è¦ä¿¡æ¯ã€æ—¶é—´èŒƒå›´ã€æˆåŠŸæ•°é‡å’Œè€—æ—¶ç­‰å…³é”®æŒ‡æ ‡ï¼Œå¹¶æä¾›"æŸ¥çœ‹è¯¦æƒ…"æŒ‰é’®ã€‚

**æœ¬èŠ‚æ¥æº**  
- [index.vue](file://frontend/src/views/mainforce/index.vue#L254-L279)

### UIçŠ¶æ€ç®¡ç†æ–¹æ¡ˆ
ç³»ç»Ÿå®ç°äº†å®Œæ•´çš„UIçŠ¶æ€ç®¡ç†ï¼Œæ¶µç›–åŠ è½½ä¸­ã€æ— æ•°æ®å’Œé”™è¯¯æç¤ºç­‰åœºæ™¯ã€‚

#### åŠ è½½çŠ¶æ€
å½“è°ƒç”¨APIè·å–å†å²æ•°æ®æ—¶ï¼Œ`historyLoading`æ ‡å¿—è¢«è®¾ç½®ä¸ºtrueï¼Œæ˜¾ç¤ºåŠ è½½åŠ¨ç”»ã€‚åŠ è½½å®Œæˆåï¼Œæ— è®ºæˆåŠŸæˆ–å¤±è´¥ï¼Œéƒ½ä¼šå°†è¯¥æ ‡å¿—é‡ç½®ä¸ºfalseã€‚

```mermaid
stateDiagram-v2
[*] --> Idle
Idle --> Loading : "è°ƒç”¨loadHistory()"
Loading --> Success : "APIè¿”å›æˆåŠŸ"
Loading --> Error : "APIè°ƒç”¨å¤±è´¥"
Success --> Idle : "è®¾ç½®historyLoading=false"
Error --> Idle : "è®¾ç½®historyLoading=false"
```

**å›¾ç¤ºæ¥æº**  
- [index.vue](file://frontend/src/views/mainforce/index.vue#L634-L646)

#### æ— æ•°æ®çŠ¶æ€
å½“è¿‡æ»¤åæ²¡æœ‰åŒ¹é…çš„å†å²è®°å½•æ—¶ï¼Œç³»ç»Ÿä¼šæ˜¾ç¤º`el-empty`ç»„ä»¶ï¼Œæç¤º"æš‚æ— å†å²è®°å½•"ã€‚è¿™æ˜¯é€šè¿‡`v-if`æŒ‡ä»¤å’Œ`filteredHistory.length === 0`æ¡ä»¶åˆ¤æ–­å®ç°çš„ã€‚

#### é”™è¯¯å¤„ç†
ç³»ç»Ÿå®ç°äº†å®Œå–„çš„é”™è¯¯å¤„ç†æœºåˆ¶ã€‚å½“APIè°ƒç”¨å¤±è´¥æ—¶ï¼Œä¼šæ•è·å¼‚å¸¸ï¼Œæ˜¾ç¤ºå‹å¥½çš„é”™è¯¯æç¤ºæ¶ˆæ¯ï¼Œå¹¶åŠ è½½ç¤ºä¾‹æ•°æ®ä»¥ä¿è¯ç”¨æˆ·ä½“éªŒã€‚

**æœ¬èŠ‚æ¥æº**  
- [index.vue](file://frontend/src/views/mainforce/index.vue#L634-L646)

## ä¾èµ–åˆ†æ
å†å²è®°å½•åŠŸèƒ½æ¶‰åŠå¤šä¸ªæ–‡ä»¶çš„ååŒå·¥ä½œï¼Œå½¢æˆäº†æ¸…æ™°çš„ä¾èµ–é“¾ã€‚

```mermaid
classDiagram
class indexVue {
+historyList : Array
+historySearch : String
+historyLoading : Boolean
+loadHistory() : Promise
+loadHistoryItem(item) : void
}
class mainforceJs {
+getMainforceHistory(params) : Promise
}
class mainforcePy {
+get_history(page, page_size) : JSON
}
class mainforceServicePy {
+get_history(page, page_size) : Dict
}
class mainforceBatchDbPy {
+get_all_history(limit) : List[Dict]
}
indexVue --> mainforceJs : "å¯¼å…¥API"
mainforceJs --> mainforcePy : "HTTPè¯·æ±‚"
mainforcePy --> mainforceServicePy : "è°ƒç”¨æœåŠ¡æ–¹æ³•"
mainforceServicePy --> mainforceBatchDbPy : "è°ƒç”¨æ•°æ®åº“æ–¹æ³•"
```

**å›¾ç¤ºæ¥æº**  
- [index.vue](file://frontend/src/views/mainforce/index.vue)
- [mainforce.js](file://frontend/src/api/mainforce.js)
- [mainforce.py](file://backend/app/api/v1/mainforce.py)
- [mainforce_service.py](file://backend/app/services/mainforce_service.py)
- [mainforce_batch_db.py](file://backend/app/db/mainforce_batch_db.py)

**æœ¬èŠ‚æ¥æº**  
- [index.vue](file://frontend/src/views/mainforce/index.vue)
- [mainforce.js](file://frontend/src/api/mainforce.js)
- [mainforce.py](file://backend/app/api/v1/mainforce.py)
- [mainforce_service.py](file://backend/app/services/mainforce_service.py)
- [mainforce_batch_db.py](file://backend/app/db/mainforce_batch_db.py)

## æ€§èƒ½è€ƒè™‘
ç³»ç»Ÿåœ¨æ€§èƒ½æ–¹é¢è¿›è¡Œäº†å¤šé¡¹ä¼˜åŒ–ï¼š

1. **åˆ†é¡µæŸ¥è¯¢**ï¼šåç«¯APIæ”¯æŒåˆ†é¡µå‚æ•°ï¼ˆpageå’Œpage_sizeï¼‰ï¼Œé¿å…ä¸€æ¬¡æ€§åŠ è½½è¿‡å¤šæ•°æ®ã€‚
2. **å‰ç«¯ç¼“å­˜**ï¼š`candidateCsvCache`ç”¨äºç¼“å­˜å¯¼å‡ºçš„CSVæ•°æ®ï¼Œé¿å…é‡å¤ç”Ÿæˆã€‚
3. **å¼‚æ­¥åŠ è½½**ï¼šæ‰€æœ‰APIè°ƒç”¨å‡ä½¿ç”¨async/awaitï¼Œé¿å…é˜»å¡UIçº¿ç¨‹ã€‚
4. **è™šæ‹Ÿæ»šåŠ¨**ï¼šè™½ç„¶å½“å‰æœªå®ç°ï¼Œä½†å»ºè®®åœ¨æ•°æ®é‡å¤§æ—¶ä½¿ç”¨è™šæ‹Ÿæ»šåŠ¨ä¼˜åŒ–æ—¶é—´è½´æ€§èƒ½ã€‚

**æœ¬èŠ‚æ¥æº**  
- [mainforce_service.py](file://backend/app/services/mainforce_service.py#L221-L223)
- [index.vue](file://frontend/src/views/mainforce/index.vue#L467-L470)

## æ•…éšœæ’é™¤æŒ‡å—
### å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ

| é—®é¢˜ç°è±¡ | å¯èƒ½åŸå›  | è§£å†³æ–¹æ¡ˆ |
|---------|--------|---------|
| å†å²è®°å½•æ— æ³•åŠ è½½ | åç«¯APIæœåŠ¡æœªå¯åŠ¨ | æ£€æŸ¥åç«¯æœåŠ¡çŠ¶æ€ï¼Œç¡®ä¿`start_server.bat`å·²æ­£ç¡®è¿è¡Œ |
| æœç´¢åŠŸèƒ½æ— æ•ˆ | è¿‡æ»¤é€»è¾‘é”™è¯¯ | æ£€æŸ¥`filteredHistory`è®¡ç®—å±æ€§çš„å®ç° |
| æ—¶é—´è½´æ˜¾ç¤ºå¼‚å¸¸ | æ•°æ®æ ¼å¼ä¸åŒ¹é… | æ£€æŸ¥APIè¿”å›çš„æ•°æ®ç»“æ„æ˜¯å¦ç¬¦åˆé¢„æœŸ |
| åŠ è½½åŠ¨ç”»ä¸€ç›´æ˜¾ç¤º | å¼‚å¸¸æœªè¢«æ•è· | æ£€æŸ¥`loadHistory`æ–¹æ³•ä¸­çš„try-catchå— |

**æœ¬èŠ‚æ¥æº**  
- [index.vue](file://frontend/src/views/mainforce/index.vue#L634-L646)
- [mainforce.py](file://backend/app/api/v1/mainforce.py#L48-L61)

## ç»“è®º
ä¸»åŠ›é€‰è‚¡å†å²è®°å½•åŠŸèƒ½é€šè¿‡å‰åç«¯ååŒå·¥ä½œï¼Œå®ç°äº†å†å²åˆ†ææ‰¹æ¬¡çš„å¯è§†åŒ–å±•ç¤ºã€‚å‰ç«¯ä½¿ç”¨æ—¶é—´è½´å¸ƒå±€æ¸…æ™°å‘ˆç°å„æ‰¹æ¬¡ä¿¡æ¯ï¼Œç»“åˆæœç´¢è¿‡æ»¤åŠŸèƒ½æä¾›è‰¯å¥½çš„ç”¨æˆ·ä½“éªŒã€‚ç³»ç»Ÿå…·å¤‡å®Œå–„çš„é”™è¯¯å¤„ç†å’ŒçŠ¶æ€ç®¡ç†æœºåˆ¶ï¼Œç¡®ä¿åœ¨å„ç§åœºæ™¯ä¸‹éƒ½èƒ½æä¾›ç¨³å®šçš„æœåŠ¡ã€‚å»ºè®®åç»­ç‰ˆæœ¬å®ç°`history.vue`çš„å®Œæ•´åŠŸèƒ½ï¼Œå¹¶è€ƒè™‘åœ¨æ•°æ®é‡å¤§æ—¶å¼•å…¥è™šæ‹Ÿæ»šåŠ¨ä¼˜åŒ–æ€§èƒ½ã€‚